Patiences.Apps={},Patiences.Abstracts={},Patiences.Locale.ruleGoalFoundations="Соберите все карты на основаниях.",Patiences.Abstracts.Foundations=Patiences.Game.inherit({goalText:Patiences.Locale.ruleGoalFoundations,_declareGame:function(){Patiences.Abstracts.Foundations.superclass._declareGame.apply(this,arguments),this.addAvailLeadsRules({"->home":100,"home->":0})},isWin:function(){return 0==this._deck.getCardsCount()&&this.getPlaces("!home").every(function(e){return e.isEmpty()})}}),Effects.CardsJumps=Effects.Abstract.inherit({duration:0,className:"_70",css:{"._70_0":{position:"absolute"}},html:'<canvas class="_70_1"></canvas>',_initComponent:function(){Effects.CardsJumps.superclass._initComponent.apply(this,arguments);var e=this._getEl("_70_1");this._ctx=e&&e.getContext("2d")},setSize:function(){Effects.CardsJumps.superclass.setSize.apply(this,arguments);var e=this._getEl("_70_1");e&&(e.setAttribute("width",this._size[0]),e.setAttribute("height",this._size[1]))},_createEffect:function(e){var t=this.game.getPlaces().filter(function(e){return!e.isEmpty()});if(!t.length)return null;var s=t[Bricks.rand(t.length-1)],a=s.getTopCard(),i=Bricks.DOM.getPos(a.getEl()),n=this._getElPos(),r=this._translatePoint([i[0]-n[0],i[1]-n[1]]),c=Bricks.DOM.getSize(a.getEl()),l=this._size[0]/5e3,o=this._size[0]/3e3,u=Math.random()*(o-l)+l;Math.random()>r[0]/this._size[0]&&(u*=-1);var d=new Image;d.src=a.getImage(),d.className="_70_0",this._ctx||(this._getEl().appendChild(d),Bricks.DOM.setStyle(d,{left:r[0]+"px",top:r[1]+"px",width:Deck.cardSize[0]+"px",height:Deck.cardSize[1]+"px"}));var h=r[1],p=this._size[1]-c[1],m=.005,g=.5,f=.9;return a.getPlace(!0).releaseCard(),a.destroy(),{startTime:e,lastUpdateTime:e,image:d,startOffset:r,speedX:u,startYTime:e,nextZeroYTime:e+Math.sqrt(2*(p-h)/m),startYPos:h,endYPos:p,startYSpeed:0,minYSpeed:1,elasticity:Math.random()*(f-g)+g,g:m}},_updateEffect:function(e,t){if(this._ctx){for(;e.lastUpdateTime<t;)if(!this._70_2(e,e.lastUpdateTime+10))return!1;return!0}return this._70_2(e,t)},_destroyEffect:function(e){this._ctx||this._getEl().removeChild(e.image)},_70_2:function(e,t){for(;e.nextZeroYTime<t;)e.startYSpeed||(e.startYSpeed=-e.g*(e.nextZeroYTime-e.startYTime)),e.startYSpeed=Math.min(-e.minYSpeed,e.startYSpeed*e.elasticity),e.startYPos=e.endYPos,e.startYTime=e.nextZeroYTime,e.nextZeroYTime-=2*e.startYSpeed/e.g;var s=t-e.startYTime,a=[e.startOffset[0]-(t-e.startTime)*e.speedX,e.startYPos+e.startYSpeed*s+e.g*s*s/2];return this._ctx?this._ctx.drawImage(e.image,a[0],a[1],Deck.cardSize[0],Deck.cardSize[1]):Bricks.DOM.setStyle(e.image,{left:a[0]+"px",top:a[1]+"px"}),e.lastUpdateTime=t,a[0]>-Deck.cardSize[0]&&a[0]<this._size[0]}}),Patiences.Locale.cellsRightTop="справа вверху",Patiences.Locale.cellsFoundations="Основания",Patiences.Locale.ruleEmptyCellAce="В пустую ячейку можно положить туза.",Patiences.Locale.ruleSequenceSuitUpEmpty="На карту можно положить карту той же масти на единицу большего достоинства.",Patiences.Abstracts.SimpleFoundations=Patiences.Abstracts.Foundations.inherit({foundationsCells:[],foundationsZone:null,foundationsLabel:Patiences.Locale.cellsRightTop,noCardsJumps:!1,_declareGame:function(){Patiences.Abstracts.SimpleFoundations.superclass._declareGame.apply(this,arguments),4!=this.foundationsCells.length||this.noCardsJumps||(this.winEffectCtor=Effects.CardsJumps),this.createPlaces({labels:["home"],isFriend:function(e){return e.isEmpty()&&1==e.getNominal()},isCardFriend:function(e,t){return t.isEmpty()&&e.getSuit()==t.getSuit()&&e.getNominal()==t.getNominal()-1},isCardDraggable:function(e){return e.isEmpty()}},this.foundationsCells,this.foundationsZone),this.addRules(Patiences.Locale.cellsFoundations+(this.foundationsLabel?" ("+this.foundationsLabel+")":""),[Patiences.Locale.ruleEmptyCellAce,Patiences.Locale.ruleSequenceSuitUpEmpty])}}),Patiences.Helpers={},Patiences.Locale.ruleSequenceAlternateDown="На карту можно положить карту другого цвета масти на единицу меньшего достоинства вместе с картами, лежащими на ней.",Patiences.Locale.ruleEmptyCellKing="В пустую ячейку можно положить короля.",Patiences.Locale.ruleDragAlternateDownSequence="Убывающую последовательность карт с чередованием цвета масти можно перетаскивать.",Patiences.Helpers.createPlacesKingAlternateDownSequence=function(e,t,s,a,i,n){e.createPlaces({labels:[s,"king-alternatedown-sequence"],cardOffset:a,isFriend:function(e){return 13==e.getNominal()},isCardFriend:function(e,t){return e.getNominal()==t.getNominal()+1&&(e.isBlack()&&t.isRed()||e.isRed()&&t.isBlack())},isCardDraggable:function(e){if(e.isEmpty())return!0;var t=e.getNestedCard();return e.isFriend(t)&&t.isDraggable()}},i,n),e.addRules(t,[Patiences.Locale.ruleSequenceAlternateDown,Patiences.Locale.ruleDragAlternateDownSequence,Patiences.Locale.ruleEmptyCellKing]),e.addAvailLeadsRules({"king-alternatedown-sequence:friend->king-alternatedown-sequence":0,"king-alternatedown-sequence:empty->king-alternatedown-sequence:empty":0})},Patiences.Locale.titleKlondike="Косынка",Patiences.Locale.cellsTableau="Игровые ячейки",Patiences.Apps.Solitaire=Patiences.Abstracts.SimpleFoundations.inherit({title:Patiences.Locale.titleKlondike,path:"sol",similar:["sol3","doubleklondike","tripleklondike"],deckShiftCount:1,decksCount:1,_declareGame:function(){this.foundationsCells=Bricks.range(4*this.decksCount).map(function(e){return{1:[e+3,0],2:[e%4+5,Math.floor(e/4)],3:[e%6+7,Math.floor(e/6)]}[this.decksCount]},this),Patiences.Apps.Solitaire.superclass._declareGame.apply(this,arguments),Patiences.Helpers.createPlacesKingAlternateDownSequence(this,Patiences.Locale.cellsTableau,"root","bottom",Bricks.range({1:7,2:9,3:13}[this.decksCount]).map(function(e){return[e,1==this.decksCount?1:2]},this)),this.createCyclicDeck({deckConfig:{shiftCount:this.deckShiftCount,content:"CDHS*"+this.decksCount}})},getStartPlaces:function(){var e=0,t=0,s=this.getPlaces("root"),a=(s.length+1)/2*s.length,i=a-s.length;return Bricks.range(a).map(function(a){var n={place:s[s.length-e-1],front:a>=i};return e++,e>t&&(t++,e=0),n})}});